# 价格计算说明

## 📊 价格计算公式

### 基本公式

#### 1. 白色/彩色价格
```
显示价格 = 成本价 × (100 / 空差) × (1 + 利润率)
```

#### 2. 版布价
```
显示版布价 = 版布成本价 + 人工费
```

### 参数说明
- **成本价**：产品数据中的 `whitePrice`（白色）或 `colorPrice`（彩色）
- **空差 (hc)**：产品的空差值（如：91）
- **利润率**：默认为 10%（0.1），可在配置文件中修改
- **版布成本价**：产品数据中的 `samplePrice`
- **人工费**：默认为 2元，可在配置文件中修改

## 💡 计算示例

### 示例 1：白色天丝
- **成本价**：5.1 元/米
- **空差**：91
- **利润率**：10%

**计算过程：**
```
显示价格 = 5.1 × (100 / 91) × (1 + 0.1)
         = 5.1 × 1.0989 × 1.1
         = 6.16 元/米
```

### 示例 2：彩色天丝
- **成本价**：5.3 元/米
- **空差**：91
- **利润率**：10%

**计算过程：**
```
显示价格 = 5.3 × (100 / 91) × (1 + 0.1)
         = 5.3 × 1.0989 × 1.1
         = 6.40 元/米
```

### 示例 3：版布价
- **版布成本价**：7 元
- **人工费**：2 元

**计算过程：**
```
显示版布价 = 7 + 2
          = 9.00 元
```

## ⚙️ 利润率配置

### 修改默认利润率

打开文件：`lib/config/pricing.ts`

```typescript
// 修改此常量（10% = 0.1, 15% = 0.15, 20% = 0.2）
export const DEFAULT_PROFIT_MARGIN = 0.1;
```

### 修改版布价人工费

打开文件：`lib/config/pricing.ts`

```typescript
// 修改此常量（默认2元，可改为3元、4元等）
export const DEFAULT_SAMPLE_LABOR_FEE = 2;
```

### 不同利润率对比（以成本价 5.1、空差 91 为例）

| 利润率 | 计算公式 | 显示价格 |
|--------|---------|---------|
| 5%  | 5.1 × 1.0989 × 1.05 | ¥5.88 |
| 10% | 5.1 × 1.0989 × 1.10 | ¥6.16 |
| 15% | 5.1 × 1.0989 × 1.15 | ¥6.44 |
| 20% | 5.1 × 1.0989 × 1.20 | ¥6.72 |

### 不同人工费对比（以版布成本价 7元 为例）

| 人工费 | 计算公式 | 显示价格 |
|--------|---------|---------|
| 1元 | 7 + 1 | ¥8.00 |
| 2元 | 7 + 2 | ¥9.00 |
| 3元 | 7 + 3 | ¥10.00 |
| 4元 | 7 + 4 | ¥11.00 |

## 🔧 技术实现

### 价格计算函数

位置：`lib/config/pricing.ts`

#### 1. 白色/彩色价格计算函数

```typescript
/**
 * 计算显示价格
 * @param costPrice - 成本价
 * @param hc - 空差
 * @param profitMargin - 利润率（可选）
 * @returns 显示价格（保留2位小数）
 */
export function calculateDisplayPrice(
  costPrice: number,
  hc: number,
  profitMargin?: number
): number {
  const config = getPricingConfig();
  const margin = profitMargin !== undefined ? profitMargin : config.profitMargin;
  
  if (!hc || hc <= 0) {
    return Number((costPrice * (1 + margin)).toFixed(2));
  }
  
  // 计算足米价：成本价 × (100 / 空差)
  const fullMeterPrice = costPrice * (config.standardHc / hc);
  
  // 计算显示价格：足米价 × (1 + 利润率)
  const displayPrice = fullMeterPrice * (1 + margin);
  
  return Number(displayPrice.toFixed(2));
}
```

#### 2. 版布价计算函数

```typescript
/**
 * 计算版布价显示价格
 * @param sampleCostPrice - 版布成本价
 * @param laborFee - 人工费（可选）
 * @returns 版布显示价格
 */
export function calculateSampleDisplayPrice(
  sampleCostPrice: number,
  laborFee?: number
): number {
  const config = getPricingConfig();
  const fee = laborFee !== undefined ? laborFee : config.sampleLaborFee;
  
  return Number((sampleCostPrice + fee).toFixed(2));
}
```

### 使用示例

```typescript
import { calculateProductDisplayPrices } from '@/lib/config/pricing';

// 在组件中使用
const displayPrices = calculateProductDisplayPrices(product);

// 显示价格
console.log(displayPrices.whitePrice);   // 白色显示价格
console.log(displayPrices.colorPrice);   // 彩色显示价格
console.log(displayPrices.samplePrice);  // 版布显示价格
console.log(displayPrices.basePrice);    // 基础显示价格
```

## 📝 注意事项

1. **空差为0或空**：如果产品没有空差信息，直接使用：`成本价 × (1 + 利润率)`
2. **促销价优先**：如果产品有 `salePrice`（促销价），则优先显示促销价，不进行计算
3. **版布价计算方式不同**：版布价不参与空差和利润率计算，只加人工费：`成本价 + 人工费`
4. **所有价格保留2位小数**：确保价格精确到分

## 🚀 已更新的组件

所有以下组件已更新使用新的价格计算逻辑：

- ✅ `components/product/ProductCard.tsx` - 产品卡片
- ✅ `app/products/[id]/page.tsx` - 产品详情页
- ✅ `app/cart/page.tsx` - 购物车页面
- ✅ `app/quotation/page.tsx` - 最新报价页面
- ✅ `lib/store/cart.ts` - 购物车状态管理

## 🔄 价格更新流程

### 修改利润率
1. 打开 `lib/config/pricing.ts`
2. 修改 `DEFAULT_PROFIT_MARGIN` 常量值
3. 保存文件，刷新页面即可看到新价格

### 修改版布价人工费
1. 打开 `lib/config/pricing.ts`
2. 修改 `DEFAULT_SAMPLE_LABOR_FEE` 常量值
3. 保存文件，刷新页面即可看到新版布价

### 修改产品成本价
1. 打开 `data/products.json`
2. 找到对应产品
3. 修改 `whitePrice`、`colorPrice` 或 `samplePrice` 字段
4. 保存文件，刷新页面即可看到新价格

### 修改空差值
1. 打开 `data/products.json`
2. 找到对应产品
3. 修改 `hc` 字段值
4. 保存文件，刷新页面即可看到新价格

